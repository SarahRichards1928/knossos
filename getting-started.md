---
layout: page
title: Getting started
permalink: /start/
---

Preparing datasets
==================

**Knossos** needs image data in a special format. The `knossos_cuber` is a Python script that is used to convert an image dataset into this format. You can download the script here: [knossos_cuber]({{ "/downloads/knossos_cuber.zip" | prepend: site.baseurl }}).

To be able to run the Python script, make sure you have the following dependencies installed:

*   numpy
*   scipy
*   Pillow
*   PyQt4 (if you use the GUI, more about that below)

Those dependencies can usually be instead using `pip`.

There are two ways to run the script: From the Command-Line or by using the GUI.

If you run the script from the Command-Line, you get the following output:

    $ python knossos_cuber.py
    Usage: knossos_cuber.py [input directory] [output directory] [tif|jpg|png]
    Example: knossos_cuber.py input output tif

The script expects 3 options:

1.  The folder to your image dataset,
2.  the destination folder,
3.  and the file format of your images.

At present, `*.tif`, `*.jpg`, and `*.png` files are supported.

Running the script from the Command-Line with these 3 options will result in `knossos_cuber` using a default configuration on your image data. If you need to adjust some settings, right now it is best to use the GUI for that:

    $ python knossos_cuber_gui.py

Make sure to look at the following options:

1.  Specifiy the paths of `source` and `target` directory.
2.  Select the format of your image files in the drop-down menu.

    (Right now, `Source dimensions x` and `y` do not need to be filled in, since the script will get the dimensions from the image itself.)
3.  Click on the "Advanced" tab to see and adjust more options. Additional information for every option can be viewed by hovering over it.

Start the job and check the output console for the job's progress. After it has finished, start **Knossos** and load the generated `.conf` file. It should be located in the `mag1` directory inside the destination folder.

* * *


**Knossos** Quickstart Guide
============================

This tutorial should give a very rough introduction and overview about **Knossos 4.0** and its features.

**Knossos** is a multi-platform scientific tool written in C++<sup>&dagger;</sup> to visualize large volume image data generated by *Serial Blockface Scanning Electron Microscopy (SBFSEM)*. It provides the ability to overlay the image data with a user generated skeleton structure, representing the spatial structure and the connectivity of labeled neurons, and displays a three dimensional model of it.

<sub>&dagger;**Knossos** uses the following libraries: Qt, PythonQt, libCURL, openJPEG 2000, OpenGL, glut.</sub>


Lanching **Knossos**
--------------------

*   Execute **Knossos** 4.0.
*   Choose the desired dataset at the top-left menu entry: `File` - `Choose Dataset...`
*   Load a dataset with *Select Dataset Path* or choose from previously used datasets in the drop down menu.
*   The *Data cache cube edge length* option sets the *Supercube Edge*, i.e. the number of cubes to be loaded per viewport. Higher numbers require more memory.
    *   A supercube edge size of `5` is optimal for tracing (requires 250 MB RAM). Other sensible settings are `7` (requires 686 MB RAM) or `3` (54 MB RAM).
    *   When changing the supercube edge size, a restart of **Knossos** is required.
*   On exit, **Knossos** remembers the last used dataset and automatically loads it on next start.


### Launching **Knossos**

In the tool bar you can enter or paste coordinates in the format `x, y, z`, wheron the view centers automatically at the target coordinate.

### Coordinates Window

You can see four viewports which show the black-white-grey volume image data:

*   `XY` plane of the stack (upper left, red border)
*   `XZ` plane of the stack (lower left, green border)
*   `YZ` plane of the stack (upper right, blue border)
*   3D-view of the skeleton/stack (lower right)

The colors of the crosshairs visualize the direction of the viewports.

### **Knossos** viewports

All **Knossos** windows can be accessed by the menu bar in the upper left of **Knossos**.

The most relevant **Knossos** window is the annotation window:

![**Knossos** Annotation Window]({{ "/img/annotation_window.png" | prepend: site.baseurl }})



Saving/Auto-Saving/Loading
--------------------------

Before you start tracing, choose a folder and a file name for your skeleton data by pressing `File` and `Save as` in the menu bar of **Knossos**.

*   The skeleton data will be saved automatically every five minutes if changes have been made.
*   Skeleton files can be loaded into **Knossos** by choosing `File` and `Load`. Alternatively, you can also choose between recently saved files by pressing `Files` and `Recent Files`.


Basic Viewport Handling
-----------------------

To move through the dataset place the mouse cursor in one of the three slice plane viewports and

*   press `f` or `d` or use the arrow keys: Move one layer forward or backward,
*   press `f` or `d` in combination with `Shift`: Jump ten layers forward or backward,
*   press `e` or `r`: Moves *x* layers forward or backward, where *x* can be defined under `Preferences` -> `Dataset Navigation` -> `Walk frames`,
*   move the mouse wheel up or down to slowly move through the dataset.
*   By pressing the left mouse button, you can
    *   and pull the stack in the desired destination (if `View` -> `Work Mode` is *Drag Dataset*)
    * or let **Knossos** center on that point (if `View` -> `Work Mode` is *Recenter on Click*).
*   To translate/rotate in the skeleton viewport, press and hold the left/right mouse button inside the skeleton viewport and drag.
*   To zoom into the dataset or into the skeleton viewport, place the mouse cursor in one of the four viewports and press `i` or `o` to zoom in/out.
*   To resize the viewports drag the corner buttons and to move them, use `Ctrl + left mouse drag`. To restore the standard positions and sizes click the button `Reset viewports` in the tool bar.


Skeleton Tracing
----------------

Nodes are placed by a right click in one of the three slice plane viewports, and are automatically linked to the last node. To just "drop" nodes without linking you have to change the work mode via *Edit Skeleton* and *Work Mode* in the menu bar.

*   The currently active node can be recognized by its number which appears beside the point or via the Annotation window.
*   You can activate a node by holding down `Shift` and left-clicking it or by simply entering the desired node ID in the *Active Node ID* field of the Annotation window. Press `x`/`Shift+X` in one of the viewports to activate the next/previous node. To change the active tree, press `z` or `Shift+Z`.
*   To jump to the active node press `s` or click on *Jump to node* in the Annotation window.
*   You can delete the active node by pressing `Del` on your keyboard or by clicking on `Delete Node` in the Annotation window.
*   If you want to reposition a node, simply click on the node with the middle mouse button and drag it to another position. The node does not have to be your active node.
*   You can add branch nodes by holding `Ctrl` while pressing the right mouse button. To transform a normal node to a branch node press `b` or choose `Push Branch Node` in the Annotation window. To jump to the last placed branch node, press `j` or use `Pop & Jump` in the Annotation window. This transforms the branch node to a normal node.
*   Different node colors indicate different node types:
    *   Blue: Branch node
    *   Yellow: Commented node (will be blue, if it is also a branch node)
*   To link two non-connected nodes or to unlink two connected nodes, activate one of them, hold `Alt` and left click the second node or hold `Shift` and click on the second node with the mouse wheel. Alternatively this can also be done in the Annotation window.
*   If you want to delete a huge part of the skeleton, isolate this part by unlinking the corresponding nodes and pressing `Split Last Component From Tree`. This divides that tree into two trees; using `Delete Active Tree` deletes this part. The Button `Merge Trees` merges two trees into one tree.


Comments
--------

You can add a comment on every tree and on every node by using the lists in the Annotation window.

*   If you use some comments regularly, you can enter them in the *Comment Settings* window and add them to the active node by pressing `F1-F5`.
*   In the Comment Settings Window you can also change the comment highlighting.

![**Knossos** Comment Window]({{ "/img/comments_window.png" | prepend: site.baseurl }})


Shortcuts
---------

### Application Shortcuts

| Shortcut | Action
|:-:|:-
| Ctrl+O | Load skeleton from file
| Ctrl+S | Save skeleton
| Ctrl+C | Copy current coordinates
| Ctrl+V | Paste coordinates
| Ctrl+H | Open this documentation
| Ctrl+Q<br>(equal to `Alt+F4`) | Close **Knossos**

### Tree Shortcuts

| Shortcut | Action
|:-:|:-
| C | Create a new tree
| Z/Shift+Z | Move to next/previous tree (by tree ID)
| X/Shift+X | Move to next/previous node (by node ID)

### Node Shortcuts

| Shortcut | Action
|:-:|:-
| S | Jump to active node
| DEL | Delete active node
| B | Mark active node as branch node
| J | Jump to last branch node
| Shift + left click on node | Reduce selection to clicked node
| Ctrl + left click on node | Add/Remove node from selection
| Ctrl + left mouse drag | Pull selection square to select multiple nodes
| Alt + left click on node<br>(equal to SHIFT + mouse wheel click on node) | Add/delete segment between clicked node and active node
| Mouse wheel hold and drag on node | Move node to new position
| A | Change to work mode "Add node"
| W | Change to work mode "Link node"
| N/P | Jump to next/previous comment node
| F1-F5 | Custom comment shortcuts

### Viewport Shortcut

| Shortcut | Action
|:-:|:-
| Left/Right arrow key | Jump [Jump Frames] steps left/right in active viewport<br>(Jump Frames can be defined at "Preferences">"Dataset Navigation")
| SHIFT + Left/Right arrow key | Jump 10 steps left/right in active viewport
| Up/Down arrow key | Jump [Jump Frames] steps up/down in active viewport
| SHIFT + Up/Down arrow key | Jump 10 steps up/down in active viewport
| F/D<br>(equal to mouse wheel forward/backward) | Jump [Jump Frames] steps forward/backward in active viewport<br>(Jump Frames can be defined at "Preferences">"Dataset Navigation")
| SHIFT + F/D | Jump 10 steps forward/backward in active viewport
| R/E | Move [Walk Frames] steps forward/backward in active viewport<br>(Walk Frames can be defined at "Preferences">"Dataset Navigation")
| SHIFT + R/E | Move 10 steps forward/backward in active viewport
| I/O in orthogonal viewports<br>(equal to CTRL + mouse scroll) | Zoom in and out of orthogonal viewports
| CTRL+ALT+left mouse drag | drag viewport<br>(restore original position by clicking on "reset viewports" in the tool bar)
| 3 | Toggle viewport crosshairs